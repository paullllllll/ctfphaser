<!DOCTYPE html>
<html>
	<head>
		
		<script src="https://ctfphaser-c9-paullllllll.c9.io/build/phaser.js"></script>
		<script type="text/javascript" src="https://ctfphaser-c9-paullllllll.c9.io/build/testgame/dgramclient.js"></script>
	<head>
	
	<body>
		<script> 
		
		var dgram = require('dgram-browserify');
		
		var game = new Phaser.Game(800, 600, Phaser.AUTO, 'testgame', 
							{	preload: preload, 
								create: create, 
								update: update,
								render: render  });

		var player, background, bullet;
		var speed = 10;
		var hasJumped = false;
		var map, layer;
		var fireRate = 100, nextFire = 0;
		var bullets = [];

		function preload() {

			game.load.image('player', 'assets/sprite1.png');
			game.load.image('tileset' , 'assets/tileset.png');
			game.load.image('pew', 'assets/pew.png');
			game.load.tilemap('map', 'assets/bg.json', null, Phaser.Tilemap.TILED_JSON);

		}

		function create() {

	              	game.width = 4000;
	              	game.height = 2000;
                
			game.physics.startSystem(Phaser.Physics.P2JS);

			map = game.add.tilemap('map');
			map.addTilesetImage('tileset', 'tileset');		

			layer = map.createLayer('please');
		       	layer.resizeWorld();
			layer.fixedToCamera=false;
	
		       	map.setCollision(1);
	
		       	mapPhys = game.physics.p2.convertTilemap(map,layer);
		       	
		       	game.physics.p2.gravity.y =980;
		       	game.physics.p2.friction = 1.5;
	
		       	player = game.add.sprite(400, 300, 'player');
			game.physics.p2.enable(player);
	                   
	                       
			player.body.collideWorldBounds = true;
			player.body.fixedRotation = true;	
				
			game.camera.follow(player);
	              	game.physics.p2.setBoundsToWorld(true, true, true, true, false);
	
	              	game.input.onDown.add(fire, this);
				
		}

		function fire(pointer){
			if(pointer.x-400>0){  bullet = game.add.sprite(player.body.x+20, player.body.y-5, 'pew');  }
			else{  bullet = game.add.sprite(player.body.x-20, player.body.y-5, 'pew');  }
			game.physics.p2.enable(bullet);
			bullet.body.kinematic = true;
	
			bullet.body.velocity.x = 900*(pointer.x-(400))/(Math.sqrt((pointer.x-400)*(pointer.x-400)+(pointer.y-300)*(pointer.y-300)));
			
			bullet.body.velocity.y = 900*(pointer.y-(300))/(Math.sqrt((pointer.x-400)*(pointer.x-400)+(pointer.y-300)*(pointer.y-300)));
			
			bullet.body.angularVelocity = 30;
	
			console.log("angle vel: "+bullet.body.angularVelocity+" p x: "+pointer.x+" p y: "+pointer.y+" pl x: "+player.body.x+" pl y: "+player.body.y);
			
		}
		
		
		function update() {
			
			//player.body.rotation = 0;
			
			if (game.input.keyboard.isDown(Phaser.Keyboard.A))
			{
				
				player.body.moveLeft(300);
				//player.body.angle = -15;

			}
			else if (game.input.keyboard.isDown(Phaser.Keyboard.D))
			{
				
				player.body.moveRight(300);
				//player.body.angle = 15;

			}
			
			else{
				
				player.body.rotation = 0;
			
			}
			
			if(game.input.keyboard.isDown(Phaser.Keyboard.W)){
			        
				player.body.moveUp(300);
                                
			}
		}


        function render(){

        }
		
		
	
		</script>
	
	</body>
	
</html>